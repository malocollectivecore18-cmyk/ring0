<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RING-0 | Lost & Found Properties</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Supabase JS (required for realtime and DB) -->
    <!-- NEW (v2.x) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>

    <!-- Modular integration scripts -->

    <script src="js/config.js"></script>

      <!-- Then deployment helper for online features -->
      <script src="js/deployment.js"></script>

      <!-- Then supabase.js -->
      <script src="js/supabase.js"></script>

      <!-- Then other scripts -->
      <script src="js/realtime.js"></script>
      <script src="js/cloudinary.js"></script>
      <script src="js/sync.js"></script>
      <script src="js/offline.js"></script>
      <script src="js/ui.js"></script>
      <script src="js/app.js"></script>
      <script src="js/diagnostics.js"></script>
    <style>
        :root {
            --bg: #0f1220;
            --card: #171a2e;
            --accent: #5b8cff;
            --text: #e8eaf6;
            --muted: #9aa0c6;
            --success: #35d07f;
            --warning: #ff6b6b;
            --gold: #ffd700;
            --notification: #ff6b6b;
            --danger: #ff4757;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', system-ui, Arial;
            background: linear-gradient(120deg, #0f1220, #0b0e1a);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header Styles - Matching RING-0 Style */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: linear-gradient(270deg, #0f1220, #0b0e1a, #1b1f3d, #0f1220);
            background-size: 800% 800%;
            animation: gradientBG 15s ease infinite;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, .1);
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .header-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: #fff;
        }
        .zero{
            color:#fff;
        }
        .header-title  {
            color: var(--accent);
        }
        
        .header-nav {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .nav-btn {
            background: rgba(12, 16, 36, 0.8);
            border: 1px solid rgba(91, 140, 255, 0.3);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .nav-btn:hover {
            background: rgba(91, 140, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .nav-btn.admin {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .nav-btn.admin:hover {
            background: rgba(255, 107, 107, 0.2);
        }
        
        .notification-badge {
            background: var(--warning);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* Admin Login Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: radial-gradient(120% 120% at 0% 0%, #1b1f3d, var(--card));
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(91, 140, 255, 0.3);
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), #4a7dff);
            border-radius: 20px 20px 0 0;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
        }

        /* Enhanced admin login form styling */
        .admin-login-form {
            background: radial-gradient(120% 120% at 0% 0%, #1b1f3d, var(--card));
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(91, 140, 255, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .admin-login-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--warning), #ff6b6b);
        }

        .admin-login-title {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 30px;
            font-weight: 700;
        }

        .admin-login-title .zero {
            color: var(--warning);
        }

        .admin-login-subtitle {
            color: var(--muted);
            margin-bottom: 30px;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Enhanced form input styling */
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-label {
            font-size: 0.8rem;
            color: var(--muted);
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
            text-align: left;
        }

        .form-input {
            width: 100%;
            padding: 14px 18px;
            background: rgba(12, 16, 36, 0.8);
            border: 2px solid rgba(91, 140, 255, 0.3);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            outline: none;
        }

        .form-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(91, 140, 255, 0.15);
            transform: translateY(-1px);
        }

        .form-input.error {
            border-color: var(--warning);
            background: rgba(255, 107, 107, 0.05);
            animation: shake 0.5s ease;
        }

        .admin-error-message {
            color: var(--warning);
            font-size: 0.85rem;
            margin-top: 8px;
            display: none;
            text-align: left;
            font-weight: 500;
        }

        /* Enhanced modal buttons */
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 12px 28px;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.8rem;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, var(--accent), #4a7dff);
            color: white;
            box-shadow: 0 4px 15px rgba(91, 140, 255, 0.3);
        }

        .modal-btn.primary:hover {
            background: linear-gradient(135deg, #4a7dff, var(--accent));
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(91, 140, 255, 0.4);
        }

        .modal-btn.cancel {
            background: rgba(155, 160, 198, 0.1);
            color: var(--text);
            border: 2px solid rgba(155, 160, 198, 0.3);
        }

        .modal-btn.cancel:hover {
            background: rgba(155, 160, 198, 0.2);
            transform: translateY(-2px);
            border-color: rgba(155, 160, 198, 0.5);
        }

        /* Enhanced animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }

        /* Password visibility toggle */
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            padding: 5px;
            transition: all 0.3s ease;
        }

        .password-toggle:hover {
            color: var(--accent);
        }

        /* Loading state for login */
        .modal-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .modal-btn.loading::after {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Security indicator */
        .security-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
            padding: 10px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .security-indicator i {
            color: var(--warning);
            font-size: 1rem;
        }

        .security-indicator span {
            color: var(--muted);
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-title.warning {
            color: var(--warning);
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        
        .modal-btn {
            padding: 10px 25px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            min-width: 100px;
        }
        
        .modal-btn.primary {
            background: linear-gradient(90deg, var(--accent), #4a7dff);
            color: white;
        }
        
        .modal-btn.primary:hover {
            background: linear-gradient(90deg, #4a7dff, var(--accent));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(91, 140, 255, 0.3);
        }
        
        .modal-btn.cancel {
            background: rgba(155, 160, 198, 0.1);
            color: var(--text);
            border: 1px solid rgba(155, 160, 198, 0.3);
        }
        
        .modal-btn.cancel:hover {
            background: rgba(155, 160, 198, 0.2);
            transform: translateY(-2px);
        }
        
        .modal-btn.confirm {
            background: linear-gradient(90deg, var(--warning), #ff5252);
            color: white;
        }
        
        .modal-btn.confirm:hover {
            background: linear-gradient(90deg, #ff5252, var(--warning));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        /* Hero Section with Animation */
        .hero-section {
            height: 60vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(12, 16, 36, 0.7) 0%, rgba(23, 26, 46, 0.7) 100%);
        }
        
        .hero-image {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0;
            animation: heroAnimation 4s ease-in-out forwards;
            animation-delay: 0.5s;
        }
        
        @keyframes heroAnimation {
            0% {
                opacity: 0;
                transform: scale(1.2);
            }
            20% {
                opacity: 1;
                transform: scale(1.1);
            }
            80% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1);
            }
        }
        
        .hero-text {
            font-size: 4rem;
            font-weight: 900;
            color: white;
            text-align: center;
            opacity: 0;
            animation: textFadeIn 2s ease-in-out forwards;
            animation-delay: 4s;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            letter-spacing: 2px;
        }
        
        @keyframes textFadeIn {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Main Content */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* Dashboard Tabs */
        .dashboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: transparent;
            border: none;
            color: var(--muted);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .tab-btn.active {
            background: rgba(91, 140, 255, 0.1);
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }
        
        .tab-btn:hover:not(.active) {
            background: rgba(155, 160, 198, 0.1);
        }
        
        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Stats Container */
        .stats-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2px;
            margin-bottom: 30px;
            background: rgba(12, 16, 36, 0.5);
            border-radius: 12px;
            border: none;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
        }
        
        .stat-number {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
            line-height: 1;
        }
        
        .stat-label {
            color: var(--muted);
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        /* Property Upload Form */
        .upload-form {
            background: rgba(12, 16, 36, 0.5);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(91, 140, 255, 0.2);
        }
        
        .form-title {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 25px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-size: 0.8rem;
            color: var(--muted);
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(12, 16, 36, 0.8);
            border: 1px solid rgba(91, 140, 255, 0.3);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(91, 140, 255, 0.2);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Category Selection */
        .category-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .category-btn {
            flex: 1;
            padding: 2px;
            background: rgba(12, 16, 36, 0.5);
            border: 2px solid rgba(91, 140, 255, 0.2);
            border-radius: 12px;
            color: var(--text);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .category-btn:hover {
            background: rgba(91, 140, 255, 0.1);
            transform: translateY(-5px);
        }
        
        .category-btn.active {
            background: rgba(91, 140, 255, 0.2);
            border-color: var(--accent);
            box-shadow: 0 10px 20px rgba(91, 140, 255, 0.1);
        }
        
        .category-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        /* Image Upload Area */
        .image-upload-area {
            border: 2px dashed rgba(91, 140, 255, 0.3);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            background: rgba(12, 16, 36, 0.3);
        }
        
        .image-upload-area:hover {
            border-color: var(--accent);
            background: rgba(91, 140, 255, 0.05);
        }
        
        .image-upload-area.dragover {
            border-color: var(--success);
            background: rgba(53, 208, 127, 0.05);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--muted);
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: var(--muted);
            font-size: 0.8rem;
            margin-bottom: 10px;
        }
        
        .upload-hint {
            color: var(--muted);
            font-size: 0.55rem;
        }

        /* Upload Progress Bar Styles */
        .upload-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.8rem;
        }

        .upload-progress-title {
            color: var(--text);
            font-weight: 600;
        }

        .upload-progress-percent {
            color: var(--accent);
            font-weight: 700;
        }

        .upload-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(12, 16, 36, 0.8);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .upload-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #4a7dff);
            width: 0%;
            transition: width 0.3s ease;
        }

        .upload-progress-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--muted);
        }
        
        .preview-image {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            margin: 15px auto;
            display: block;
            border: 2px solid rgba(91, 140, 255, 0.3);
        }
        
        /* Form Buttons */
        .form-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .form-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-btn.primary {
            background: linear-gradient(90deg, var(--accent), #4a7dff);
            color: white;
        }
        
        .form-btn.primary:hover {
            background: linear-gradient(90deg, #4a7dff, var(--accent));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(91, 140, 255, 0.3);
        }
        
        .form-btn.secondary {
            background: rgba(155, 160, 198, 0.1);
            color: var(--text);
            border: 1px solid rgba(155, 160, 198, 0.3);
        }
        
        .form-btn.secondary:hover {
            background: rgba(155, 160, 198, 0.2);
            transform: translateY(-2px);
        }
        
        /* Search Section */
        .search-section {
            background: rgba(12, 16, 36, 0.5);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(91, 140, 255, 0.2);
        }
        
        .search-title {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Properties Gallery */
        .properties-gallery {
            background: rgba(12, 16, 36, 0.5);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(91, 140, 255, 0.2);
        }
        
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .gallery-title {
            font-size: 1.5rem;
            color: var(--accent);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 8px 16px;
            background: rgba(12, 16, 36, 0.8);
            border: 1px solid rgba(91, 140, 255, 0.3);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .view-btn.active {
            background: rgba(91, 140, 255, 0.2);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* Properties Grid */
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }
        
        .property-card {
            background: radial-gradient(120% 120% at 0% 0%, #1b1f3d, var(--card));
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(91, 140, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border-color: var(--accent);
        }
        
        .property-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .property-content {
            padding: 20px;
        }
        
        .property-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .property-type {
            background: rgba(91, 140, 255, 0.1);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .property-date {
            color: var(--muted);
            font-size: 0.75rem;
        }
        
        .property-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text);
        }
        
        .property-details {
            color: var(--muted);
            font-size: 0.85rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .property-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        
        .info-label {
            color: var(--muted);
            font-weight: 600;
        }
        
        .property-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .action-btn.claim {
            background: linear-gradient(90deg, var(--success), #2ec571);
            color: white;
        }
        
        .action-btn.claim:hover {
            background: linear-gradient(90deg, #2ec571, var(--success));
            transform: translateY(-2px);
        }
        
        .action-btn.details {
            background: rgba(91, 140, 255, 0.1);
            color: var(--accent);
            border: 1px solid rgba(91, 140, 255, 0.3);
        }
        
        .action-btn.details:hover {
            background: rgba(91, 140, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--muted);
        }
        
        .empty-text {
            font-size: 1rem;
            max-width: 500px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }
        
        /* Notification Alert */
        .notification-alert {
            background: linear-gradient(90deg, rgba(255, 107, 107, 0.1), rgba(255, 107, 107, 0.05));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: pulseAlert 2s infinite;
        }
        
        @keyframes pulseAlert {
            0%, 100% { border-color: rgba(255, 107, 107, 0.3); }
            50% { border-color: rgba(255, 107, 107, 0.6); }
        }
        
        .alert-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .alert-icon {
            font-size: 1.8rem;
            color: var(--warning);
        }
        
        .alert-text {
            color: var(--text);
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .alert-btn {
            background: var(--warning);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }
        
        .alert-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        
        /* Modal Styles */
        .modal-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-found {
            background: rgba(53, 208, 127, 0.1);
            color: var(--success);
            border: 1px solid rgba(53, 208, 127, 0.3);
        }
        
        .status-pending {
            background: rgba(255, 215, 0, 0.1);
            color: var(--gold);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .status-claimed {
            background: rgba(91, 140, 255, 0.1);
            color: var(--accent);
            border: 1px solid rgba(91, 140, 255, 0.3);
        }
        
        /* Admin Login Form */
        .admin-login-form {
            background: radial-gradient(120% 120% at 0% 0%, #1b1f3d, var(--card));
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(91, 140, 255, 0.3);
            text-align: center;
        }
        
        .admin-login-title {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 30px;
            font-weight: 700;
        }
        
        .admin-login-title .zero {
            color: var(--warning);
        }
        
        .admin-login-subtitle {
            color: var(--muted);
            margin-bottom: 30px;
            font-size: 0.9rem;
        }
        
        .admin-error-message {
            color: var(--warning);
            font-size: 0.8rem;
            margin-top: 10px;
            display: none;
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(270deg, #0f1220, #0b0e1a, #1b1f3d, #0f1220);
            background-size: 800% 800%;
            animation: gradientBG 15s ease infinite;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, .1);
        }
        
        .admin-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #fff;
        }
        
        .admin-title .zero {
            color: var(--warning);
        }
        
        .admin-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .admin-btn {
            padding: 10px 20px;
            background: rgba(12, 16, 36, 0.8);
            border: 1px solid rgba(91, 140, 255, 0.3);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-btn:hover {
            background: rgba(91, 140, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .admin-btn.logout {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .admin-btn.logout:hover {
            background: rgba(255, 107, 107, 0.2);
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: radial-gradient(120% 120% at 0% 0%, #1b1f3d, var(--card));
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(91, 140, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-card.danger {
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .stat-card.danger:hover {
            border-color: var(--warning);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--accent);
        }
        
        .stat-card.danger .stat-icon {
            color: var(--warning);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 5px;
            line-height: 1;
        }
        
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .admin-tab-btn {
            background: transparent;
            border: none;
            color: var(--muted);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .admin-tab-btn.active {
            background: rgba(91, 140, 255, 0.1);
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }
        
        .admin-tab-btn:hover:not(.active) {
            background: rgba(155, 160, 198, 0.1);
        }
        
        .admin-tab-content {
            display: none;
            animation: fadeInUp 0.5s ease;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .properties-table-container {
            background: radial-gradient(120% 120% at 0% 0%, #1b1f3d, var(--card));
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(91, 140, 255, 0.2);
            overflow-x: auto;
        }
        
        .properties-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .properties-table th {
            text-align: left;
            padding: 15px;
            color: var(--muted);
            font-weight: 600;
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .properties-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
        }
        
        .properties-table tr:hover {
            background: rgba(91, 140, 255, 0.05);
        }
        
        .property-image-small {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .category-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            background: rgba(91, 140, 255, 0.1);
            color: var(--accent);
            border: 1px solid rgba(91, 140, 255, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .admin-action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .admin-action-btn.view {
            background: rgba(91, 140, 255, 0.1);
            color: var(--accent);
            border: 1px solid rgba(91, 140, 255, 0.3);
        }
        
        .admin-action-btn.view:hover {
            background: rgba(91, 140, 255, 0.2);
        }
        
        .admin-action-btn.delete {
            background: rgba(255, 107, 107, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .admin-action-btn.delete:hover {
            background: rgba(255, 107, 107, 0.2);
        }
        
        .modal-text {
            color: var(--text);
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: rgba(12, 16, 36, 0.8);
            border: 1px solid rgba(91, 140, 255, 0.3);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: rgba(91, 140, 255, 0.2);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .search-input {
            padding: 8px 15px;
            background: rgba(12, 16, 36, 0.8);
            border: 1px solid rgba(91, 140, 255, 0.3);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.85rem;
            min-width: 200px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(91, 140, 255, 0.2);
        }


/* Admin Back Button */
.admin-btn.back {
    background: rgba(91, 140, 255, 0.1);
    border-color: rgba(91, 140, 255, 0.3);
}

.admin-btn.back:hover {
    background: rgba(91, 140, 255, 0.2);
}


        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .header-nav {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .hero-text {
                font-size: 1.9rem;
            }
            
            .category-selector {
                flex-direction: column;
            }
            
            .form-row, .search-grid {
                grid-template-columns: 1fr;
            }
            
            .properties-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
                text-align: center;
            }
            
            .stats-container {
                flex-direction: row;
                gap: 20px;
            }
            
            .stat-item {
                width: 100%;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .admin-stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab-btn {
                width: 100%;
                text-align: center;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .main-container {
                padding: 20px 15px;
            }
            
            .form-buttons, .modal-buttons {
                flex-direction: column;
            }
            
            .form-btn, .modal-btn {
                width: 100%;
            }
            
            .property-actions {
                flex-direction: column;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(12, 16, 36, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(91, 140, 255, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(91, 140, 255, 0.7);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-title">
            RING-<span class="zero">0</span> | <span>Lost & Found Properties</span>
        </div>
        <div class="header-nav">
            <button class="nav-btn" onclick="switchTab('upload')">
                <i class="fas fa-upload"></i> Report Found Item
            </button>
            
            <button class="nav-btn" onclick="switchTab('gallery')">
                <i class="fas fa-images"></i> View Gallery
                <span class="notification-badge" id="propertiesCount">0</span>
           
            <button class="nav-btn" onclick="goBack()" id="dynamicBackButton">
    <i class="fas fa-arrow-left"></i> Back
</button>
        </div>
    </div>

    <!-- Hero Section with Animation -->
    <div class="hero-section">
        <img src="UNI-COT.png" 
             alt="Lost and Found" class="hero-image">
        <div class="hero-text">Future of the Best Smile</div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Stats Overview -->
        <div class="stats-container">
            <div class="stat-item">
                <span class="stat-number" id="totalProperties">0</span>
                <span class="stat-label">Total Properties</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="idsFound">0</span>
                <span class="stat-label">IDs Found</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="othersFound">0</span>
                <span class="stat-label">Other Items</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="claimedItems">0</span>
                <span class="stat-label">Claimed Items</span>
            </div>
        </div>

        <!-- Notification Alert (Shows when items are available) -->
        <div class="notification-alert" id="notificationAlert" style="display: none;">
            <div class="alert-content">
                <i class="fas fa-bell alert-icon"></i>
                <div class="alert-text">Someone has found your property! Check the gallery to see if it's yours.</div>
            </div>
            <button class="alert-btn" onclick="switchTab('gallery')">
                View Gallery
            </button>
        </div>

        <!-- Dashboard Tabs -->
        <div class="dashboard-tabs">
            <button class="tab-btn active" onclick="switchTab('upload')">
                <i class="fas fa-cloud-upload-alt"></i> Upload Found Property
            </button>
            <button class="tab-btn" onclick="switchTab('search')">
                <i class="fas fa-search"></i> Search for Property
            </button>
            <button class="tab-btn" onclick="switchTab('gallery')">
                <i class="fas fa-images"></i> Properties Gallery
            </button>
        </div>

        <!-- Upload Found Property Tab -->
        <div class="tab-content active" id="uploadTab">
            <div class="upload-form">
                <div class="form-title">
                    <i class="fas fa-camera"></i> Report a Found Property
                </div>
                
                <!-- Category Selection -->
                <div class="category-selector">
                    <button class="category-btn active" data-category="id" onclick="selectCategory('id')">
                        <i class="fas fa-id-card category-icon"></i>
                        <span>ID Card</span>
                        <small>Found someone's identification card</small>
                    </button>
                    <button class="category-btn" data-category="other" onclick="selectCategory('other')">
                        <i class="fas fa-box category-icon"></i>
                        <span>Other Property</span>
                        <small>Bag, book, cable, etc.</small>
                    </button>
                </div>
                
                <!-- Image Upload Area -->
                <div class="image-upload-area" id="imageUploadArea" onclick="triggerImageUpload()">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <div class="upload-text">Click to upload or drag & drop property image</div>
                    <div class="upload-hint">Supports JPG, PNG (Max 5MB)</div>
                    <img id="imagePreview" class="preview-image" style="display: none;">
                </div>
                <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                
                <!-- Form Fields (Dynamic based on category) -->
                <div id="idForm" class="category-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Owner's Full Name *</label>
                            <input type="text" class="form-input" id="ownerName" placeholder="Enter the name on the ID">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Registration Number *</label>
                            <input type="text" class="form-input" id="regNumber" placeholder="Enter registration number">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Where did you find it? *</label>
                        <input type="text" class="form-input" id="idLocation" placeholder="e.g., Library, Cafeteria, Parking Lot">
                    </div>
                </div>
                
                <div id="otherForm" class="category-form" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Property Type *</label>
                        <select class="form-select" id="propertyType">
                            <option value="">Select property type</option>
                            <option value="bag">Bag/Backpack</option>
                            <option value="book">Book/Notebook</option>
                            <option value="cable">Cable/Charger</option>
                            <option value="wallet">Wallet/Purse</option>
                            <option value="keys">Keys</option>
                            <option value="electronic">Electronic Device</option>
                            <option value="clothing">Clothing Item</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Describe the Property *</label>
                        <textarea class="form-textarea" id="propertyDescription" placeholder="Describe the property in detail (color, brand, distinguishing features, contents, etc.)"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Where did you find it? *</label>
                        <input type="text" class="form-input" id="otherLocation" placeholder="e.g., Library, Cafeteria, Parking Lot">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Your Contact Information (Optional)</label>
                    <input type="text" class="form-input" id="finderContact" placeholder="Email or phone number for follow-up">
                </div>
                
                <div class="form-buttons">
                    <button class="form-btn secondary" onclick="resetForm()">
                        <i class="fas fa-redo"></i> Reset Form
                    </button>
                    <button class="form-btn primary" onclick="submitProperty()">
                        <i class="fas fa-paper-plane"></i> Submit to Admin
                    </button>
                </div>
            </div>
        </div>

        <!-- Search for Property Tab -->
        <div class="tab-content" id="searchTab">
            <div class="search-section">
                <div class="form-title">
                    <i class="fas fa-search"></i> Search for Your Lost Property
                </div>
                
                <!-- Search Category Selection -->
                <div class="category-selector">
                    <button class="category-btn active" data-search-category="id" onclick="selectSearchCategory('id')">
                        <i class="fas fa-id-card category-icon"></i>
                        <span>Search ID Card</span>
                        <small>By name and registration number</small>
                    </button>
                    <button class="category-btn" data-search-category="other" onclick="selectSearchCategory('other')">
                        <i class="fas fa-box category-icon"></i>
                        <span>Search Other Property</span>
                        <small>By description keywords</small>
                    </button>
                </div>
                
                <!-- Search Forms -->
                <div id="idSearchForm" class="search-form">
                    <div class="search-grid">
                        <div class="form-group">
                            <label class="form-label">Your Name *</label>
                            <input type="text" class="form-input" id="searchName" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Registration Number (Optional)</label>
                            <input type="text" class="form-input" id="searchRegNumber" placeholder="Enter your registration number">
                        </div>
                    </div>
                </div>
                
                <div id="otherSearchForm" class="search-form" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Describe Your Property *</label>
                        <textarea class="form-textarea" id="searchDescription" placeholder="Describe what you lost with key details (color, brand, type, etc.)"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Property Type (Optional)</label>
                        <select class="form-select" id="searchPropertyType">
                            <option value="">Select property type</option>
                            <option value="bag">Bag/Backpack</option>
                            <option value="book">Book/Notebook</option>
                            <option value="cable">Cable/Charger</option>
                            <option value="wallet">Wallet/Purse</option>
                            <option value="keys">Keys</option>
                            <option value="electronic">Electronic Device</option>
                            <option value="clothing">Clothing Item</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button class="form-btn secondary" onclick="resetSearch()">
                        <i class="fas fa-redo"></i> Clear Search
                    </button>
                    <button class="form-btn primary" onclick="searchProperty()">
                        <i class="fas fa-search"></i> Search Properties
                    </button>
                </div>
                
                <!-- Search Results -->
                <div id="searchResults" style="margin-top: 30px; display: none;">
                    <div class="form-title">
                        <i class="fas fa-list"></i> Search Results
                    </div>
                    <div id="searchResultsContainer" class="properties-grid">
                        <!-- Search results will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Properties Gallery Tab -->
        <div class="tab-content" id="galleryTab">
            <div class="properties-gallery">
                <div class="gallery-header">
                    <div class="gallery-title">
                        <i class="fas fa-images"></i> Found Properties Gallery
                    </div>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="all" onclick="filterProperties('all')">All</button>
                        <button class="view-btn" data-view="id" onclick="filterProperties('id')">IDs</button>
                        <button class="view-btn" data-view="other" onclick="filterProperties('other')">Others</button>
                        <button class="view-btn" data-view="unclaimed" onclick="filterProperties('unclaimed')">Unclaimed</button>
                    </div>
                </div>
                
                <div id="galleryContainer" class="properties-grid">
                    <!-- Properties will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel (Hidden by default) -->
    <div class="admin-panel" id="adminPanel">
        <!-- Admin Header -->
        <div class="admin-header">
    <div class="admin-title">
        RING-<span class="zero">0</span> Admin Dashboard | <span>Lost & Found Properties</span>
    </div>
    <div class="admin-actions">
        
        <button class="admin-btn" onclick="refreshAdminData()">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
        <button class="admin-btn" onclick="goToUserInterface()">
            <i class="fas fa-user"></i> User UI
        </button>
        <button class="admin-btn logout" onclick="logoutAdmin()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>
</div>
        
        <!-- Admin Stats -->
        <div class="admin-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-box-open"></i>
                </div>
                <div class="stat-number" id="adminTotalItems">0</div>
                <div class="stat-label">Total Properties</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-id-card"></i>
                </div>
                <div class="stat-number" id="adminIdCards">0</div>
                <div class="stat-label">ID Cards</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-cube"></i>
                </div>
                <div class="stat-number" id="adminOtherItems">0</div>
                <div class="stat-label">Other Items</div>
            </div>
            
            <div class="stat-card danger">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-number" id="adminClaimedItems">0</div>
                <div class="stat-label">Claimed Items</div>
            </div>
        </div>
        
        <!-- Admin Tabs -->
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="switchAdminTab('all')">
                <i class="fas fa-list"></i> All Properties
            </button>
            <button class="admin-tab-btn" onclick="switchAdminTab('claimed')">
                <i class="fas fa-check-circle"></i> Claimed Properties
            </button>
            <button class="admin-tab-btn" onclick="switchAdminTab('unclaimed')">
                <i class="fas fa-clock"></i> Unclaimed Properties
            </button>
            <button class="admin-tab-btn" onclick="switchAdminTab('recent')">
                <i class="fas fa-history"></i> Recently Added
            </button>
        </div>
        
        <!-- Filter Section -->
        <div class="filter-section">
            <button class="filter-btn active" onclick="filterAdminByCategory('all')">All</button>
            <button class="filter-btn" onclick="filterAdminByCategory('id')">ID Cards</button>
            <button class="filter-btn" onclick="filterAdminByCategory('other')">Other Items</button>
            <input type="text" class="search-input" id="adminSearchInput" placeholder="Search properties..." onkeyup="searchAdminProperties()">
        </div>
        
        <!-- All Properties Tab -->
        <div class="admin-tab-content active" id="adminAllTab">
            <div class="properties-table-container">
                <table class="properties-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Type</th>
                            <th>Details</th>
                            <th>Location</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminAllPropertiesTable">
                        <!-- Properties will be loaded here -->
                    </tbody>
                </table>
                <div class="empty-state" id="adminAllEmptyState" style="display: none;">
                    <div class="empty-icon"></div>
                    <h3 class="empty-title">No Properties Found</h3>
                    <p class="empty-text">No properties have been reported yet.</p>
                </div>
            </div>
        </div>
        
        <!-- Claimed Properties Tab -->
        <div class="admin-tab-content" id="adminClaimedTab">
            <div class="properties-table-container">
                <table class="properties-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Type</th>
                            <th>Details</th>
                            <th>Claimant</th>
                            <th>Claim Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminClaimedPropertiesTable">
                        <!-- Claimed properties will be loaded here -->
                    </tbody>
                </table>
                <div class="empty-state" id="adminClaimedEmptyState" style="display: none;">
                    <div class="empty-icon"></div>
                    <h3 class="empty-title">No Claimed Properties</h3>
                    <p class="empty-text">No properties have been claimed yet.</p>
                </div>
            </div>
        </div>
        
        <!-- Unclaimed Properties Tab -->
        <div class="admin-tab-content" id="adminUnclaimedTab">
            <div class="properties-table-container">
                <table class="properties-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Type</th>
                            <th>Details</th>
                            <th>Location</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminUnclaimedPropertiesTable">
                        <!-- Unclaimed properties will be loaded here -->
                    </tbody>
                </table>
                <div class="empty-state" id="adminUnclaimedEmptyState" style="display: none;">
                    <div class="empty-icon"></div>
                    <h3 class="empty-title">No Unclaimed Properties</h3>
                    <p class="empty-text">All properties have been claimed.</p>
                </div>
            </div>
        </div>
        
        <!-- Recently Added Tab -->
        <div class="admin-tab-content" id="adminRecentTab">
            <div class="properties-table-container">
                <table class="properties-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Type</th>
                            <th>Details</th>
                            <th>Location</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminRecentPropertiesTable">
                        <!-- Recent properties will be loaded here -->
                    </tbody>
                </table>
                <div class="empty-state" id="adminRecentEmptyState" style="display: none;">
                    <div class="empty-icon"></div>
                    <h3 class="empty-title">No Recent Properties</h3>
                    <p class="empty-text">No properties have been added recently.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Property Details Modal -->
    <div class="modal-overlay" id="propertyModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-info-circle"></i> Property Details
            </div>
            <img id="modalImage" class="modal-image" src="" alt="Property Image">
            
            <div class="property-info">
                <div class="info-item">
                    <span class="info-label">Type:</span>
                    <span id="modalType" class="status-badge status-found"></span>
                </div>
                <div class="info-item">
                    <span class="info-label">Found On:</span>
                    <span id="modalDate"></span>
                </div>
                <div class="info-item">
                    <span class="info-label">Location:</span>
                    <span id="modalLocation"></span>
                </div>
                <div id="modalNameItem" class="info-item">
                    <span class="info-label">Owner Name:</span>
                    <span id="modalName"></span>
                </div>
                <div id="modalRegItem" class="info-item">
                    <span class="info-label">Registration No:</span>
                    <span id="modalReg"></span>
                </div>
                <div id="modalDescItem" class="info-item">
                    <span class="info-label">Description:</span>
                    <span id="modalDesc"></span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status:</span>
                    <span id="modalStatus" class="status-badge status-pending"></span>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closePropertyModal()">Close</button>
                <button class="modal-btn primary" id="claimButton" onclick="claimProperty()">
                    <i class="fas fa-hand-paper"></i> Claim This Property
                </button>
            </div>
        </div>
    </div>

    <!-- Claim Property Modal -->
    <div class="modal-overlay" id="claimModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-hand-paper"></i> Claim Property
            </div>
            
            <div class="form-group">
                <label class="form-label">Your Full Name *</label>
                <input type="text" class="form-input" id="claimantName" placeholder="Enter your full name">
            </div>
            
            <div class="form-group">
                <label class="form-label">Contact Information *</label>
                <input type="text" class="form-input" id="claimantContact" placeholder="Email or phone number">
            </div>
            
            <div class="form-group">
                <label class="form-label">Additional Proof (Optional)</label>
                <textarea class="form-textarea" id="claimProof" placeholder="Provide any additional information to prove ownership"></textarea>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeClaimModal()">Cancel</button>
                <button class="modal-btn primary" onclick="submitClaim()">
                    <i class="fas fa-paper-plane"></i> Submit Claim Request
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="modal-overlay" id="adminLoginModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-user-shield"></i> Admin Login
            </div>
            
            <div class="form-group">
                <label class="form-label">Admin Password</label>
                <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password">
                <div class="admin-error-message" id="adminPasswordError">Incorrect password. Please try again.</div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeAdminLogin()">Cancel</button>
                <button class="modal-btn primary" onclick="adminLogin()">
                    <i class="fas fa-lock"></i> Login
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-content">
            <div class="modal-title warning">
                <i class="fas fa-exclamation-triangle"></i> Confirm Deletion
            </div>
            <div class="modal-text">
                Are you sure you want to delete this property? This action cannot be undone. The property will be permanently removed from the system.
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn confirm" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Delete Property
                </button>
            </div>
        </div>
    </div>
    
    <!-- Admin Property Details Modal -->
    <div class="modal-overlay" id="adminDetailsModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-info-circle"></i> Property Details
            </div>
            <div id="adminModalContent">
                <!-- Property details will be loaded here -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeAdminDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
    // Data storage
    let properties = [];
    let filteredProperties = [];
    let currentPropertyId = null;
    let selectedCategory = 'id';
    let selectedSearchCategory = 'id';
    let currentView = 'all';

// ==================== ENHANCED CLOUDINARY CONFIGURATION ====================
const CLOUDINARY_CONFIG = {
    CLOUD_NAME: "dcpqnmdas",
    UPLOAD_PRESET: "unsigned_images",
    UPLOAD_TIMEOUT: 30000, // 30 seconds timeout
    MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB
    ALLOWED_TYPES: ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp']
};
let cloudinaryImageUrl = "";

// ===== UTILITY FUNCTIONS =====
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Go back to main admin dashboard
// Go back to main admin dashboard
function goBackToMainDashboard() {
    // First, check if we have a main admin session
    const adminSession = localStorage.getItem('ring0_admin_login');
    
    if (adminSession) {
        try {
            const session = JSON.parse(adminSession);
            // If main admin session is still valid, preserve it
            if (session.loggedIn === true && (Date.now() - session.timestamp) < (24 * 60 * 60 * 1000)) {
                // Keep the main admin session, just clear properties session
                localStorage.removeItem('ring0_admin_logged_in');
                localStorage.removeItem('ring0_direct_access');
                localStorage.removeItem('ring0_admin_source');
                
                // Set auto-return flag for 2 minutes
                localStorage.setItem('ring0_auto_return', 'true');
                localStorage.setItem('ring0_return_timestamp', Date.now().toString());
                
                // Go back to index.html - will still be in admin mode
                window.location.href = 'index.html';
                return;
            }
        } catch(e) {
            console.error('Error parsing admin session:', e);
        }
    }
    
    // If no valid main admin session, just clear everything and go to index
    localStorage.removeItem('ring0_admin_logged_in');
    localStorage.removeItem('ring0_direct_access');
    localStorage.removeItem('ring0_admin_source');
    localStorage.removeItem('ring0_admin_login');
    
    // Go to index.html (public page)
    window.location.href = 'index.html';
}


   function goBack() {
    // Check if we're in admin mode
    const isAdminLoggedIn = localStorage.getItem('ring0_admin_logged_in') === 'true';
    const cameFromDirectAccess = localStorage.getItem('ring0_direct_access') === 'true';
    
    if (isAdminLoggedIn && cameFromDirectAccess) {
        // If admin came from direct access, go to index.html
        window.location.href = 'index.html';
    } else if (window.history.length > 1) {
        // Regular browser back
        window.history.back();
    } else {
        // Default to index.html
        window.location.href = 'index.html';
    }
}
    
    // Admin variables
    const ADMIN_PASSWORD = "admin123"; // Change this to your desired password
    let currentAdminTab = 'all';
    let currentAdminCategoryFilter = 'all';
    let adminProperties = [];
    
    // Sample data for demonstration
    const sampleProperties = [
        {
            id: 1,
            category: 'id',
            image: 'https://images.unsplash.com/photo-1589829545856-d10d557cf95f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
            name: 'John Doe',
            regNumber: 'REG2023001',
            description: 'University ID card with blue background',
            location: 'Main Library, 2nd Floor',
            date: '2023-10-15',
            status: 'unclaimed',
            type: 'Student ID',
            finderContact: 'finder@example.com',
            addedDate: new Date().toISOString()
        },
        {
            id: 2,
            category: 'other',
            image: 'https://images.unsplash.com/photo-1545235617-9465d2a55698?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2080&q=80',
            name: '',
            regNumber: '',
            description: 'Black leather wallet with credit cards and driver license',
            location: 'Cafeteria, Table near window',
            date: '2023-10-14',
            status: 'claimed',
            type: 'Wallet',
            finderContact: 'anonymous',
            claimantName: 'Alice Johnson',
            claimantContact: 'alice@email.com',
            claimDate: '2023-10-16',
            addedDate: new Date(Date.now() - 86400000).toISOString() // 1 day ago
        },
        {
            id: 3,
            category: 'id',
            image: 'https://images.unsplash.com/photo-1611944212121-9c5fa5c33d42?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
            name: 'Jane Smith',
            regNumber: 'REG2023002',
            description: 'Employee ID with access card',
            location: 'Parking Lot B',
            date: '2023-10-13',
            status: 'unclaimed',
            type: 'Employee ID',
            finderContact: 'security@campus.com',
            addedDate: new Date(Date.now() - 172800000).toISOString() // 2 days ago
        },
        {
            id: 4,
            category: 'other',
            image: 'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
            name: '',
            regNumber: '',
            description: 'Red backpack with laptop compartment and water bottle pocket',
            location: 'Bus Stop near Main Gate',
            date: '2023-10-12',
            status: 'unclaimed',
            type: 'Backpack',
            finderContact: 'busdriver@transit.com',
            addedDate: new Date(Date.now() - 259200000).toISOString() // 3 days ago
        }
    ];

    // ==================== URL PARAMETER HANDLING FOR DIRECT ADMIN ACCESS ====================

    // Add this function at the beginning of your JavaScript section
    function checkURLForAdminAccess() {
        const urlParams = new URLSearchParams(window.location.search);
        const adminParam = urlParams.get('admin');

        // Check if the URL contains the admin parameter
        if (adminParam === 'direct') {
            // Clear the URL parameter from browser history
            window.history.replaceState({}, document.title, window.location.pathname);

            // Check if admin is already logged in
            const isAdminLoggedIn = localStorage.getItem('ring0_admin_logged_in');

            // Only show login popup if admin is NOT logged in
            if (isAdminLoggedIn !== 'true') {
                // Wait a moment for page to load, then trigger admin login
                setTimeout(() => {
                    openAdminLogin();
                }, 500);
            } else {
                // If already logged in, just show the admin panel directly
                setTimeout(() => {
                    showAdminPanel();
                    loadAdminProperties();
                    showMessage('Welcome back, Admin!', 'success');
                }, 500);
            }
        }
    }

// ================= MERGED ADMIN LOGIN HANDLING ====================

  // Single function to handle all admin access scenarios
function checkAdminAccess() {
    const urlParams = new URLSearchParams(window.location.search);
    const adminParam = urlParams.get('admin');
    const sourceParam = urlParams.get('source');
    const autoReturnParam = urlParams.get('autoReturn');

    // Check if this is an auto-return (coming back from index.html)
    if (autoReturnParam === 'true') {
        // Clear URL parameters
        window.history.replaceState({}, document.title, window.location.pathname);

        // For auto-return, still require password entry - do not auto-login
        localStorage.setItem('ring0_direct_access', 'true');
        if (sourceParam) {
            localStorage.setItem('ring0_admin_source', sourceParam);
        }

        setTimeout(() => {
            openAdminLogin();
            showMessage('Please enter admin password to continue', 'info');
        }, 500);
        return;
    }

    // Check if the URL contains the admin parameter (admin access requested)
    if (adminParam === 'direct') {
        // Clear the URL parameter from browser history
        window.history.replaceState({}, document.title, window.location.pathname);

        // Store source for back button navigation
        if (sourceParam) {
            localStorage.setItem('ring0_admin_source', sourceParam);
        }

        // ALWAYS require password entry - no persistent login for properties.html
        localStorage.setItem('ring0_direct_access', 'true');

        setTimeout(() => {
            openAdminLogin();
            showMessage('Please enter admin password to access admin panel', 'info');
        }, 500);
    } else {
        // Regular user access (not admin) - clear any admin flags
        localStorage.removeItem('ring0_direct_access');
        localStorage.removeItem('ring0_admin_source');
        localStorage.removeItem('ring0_auto_return');
        localStorage.removeItem('ring0_return_timestamp');
        // Also clear admin login state for properties
        localStorage.removeItem('ring0_admin_logged_in');
    }
}


// Update back button text based on context
function updateBackButtonText() {
    // Update HEADER back button (for regular users)
    const headerBackButton = document.querySelector('.nav-btn[onclick="goBack()"]');
    if (headerBackButton) {
        headerBackButton.innerHTML = ' Back to Main';
    }
    
    // Update ADMIN back button (in admin panel)
    const adminBackButton = document.querySelector('.admin-btn.back');
    const isAdminLoggedIn = localStorage.getItem('ring0_admin_logged_in') === 'true';
    const cameFromDirectAccess = localStorage.getItem('ring0_direct_access') === 'true';
    
    if (adminBackButton && isAdminLoggedIn && cameFromDirectAccess) {
        adminBackButton.innerHTML = '<i class="fas fa-arrow-left"></i> Back to Dashboard';
    } else if (adminBackButton && isAdminLoggedIn) {
        adminBackButton.innerHTML = '<i class="fas fa-arrow-left"></i> Back to Main';
    }
}






    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        loadProperties();
        updateStats();

        // Set up drag and drop for image upload
        setupDragAndDrop();

        // Check if there are properties and show notification
        checkForPropertiesNotification();

        // Set up real-time sync listeners
        setupRealtimeSync();

        // Check for updates every 3 seconds
        setInterval(checkForAdminUpdates, 3000);

        // Check for direct admin access from URL (this will show login modal if admin access requested)
        checkAdminAccess();

        // Handle page refresh
window.addEventListener('beforeunload', function() {
    // Clear direct access flag on refresh
    localStorage.removeItem('ring0_direct_access');
});

// Check on page load if refresh happened
if (performance.navigation.type === 1) {
    // Page was refreshed
    const isAdminLoggedIn = localStorage.getItem('ring0_admin_logged_in') === 'true';
    const cameFromDirectAccess = localStorage.getItem('ring0_direct_access') === 'true';
    
    if (isAdminLoggedIn && !cameFromDirectAccess) {
        // Admin was logged in but refreshed - redirect to index.html
        window.location.href = 'index.html';
    }
}
    });

    // ==================== REAL-TIME SYNC FUNCTIONS ====================
    
    // Set up real-time sync
    function setupRealtimeSync() {
        // Listen for changes from admin panel
        window.addEventListener('storage', handleStorageEvent);
        
        // Also listen for our own custom events
        window.addEventListener('propertiesUpdated', function() {
            loadProperties();
            showMessage('Properties updated', 'success');
        });
    }

    // Handle storage events
    function handleStorageEvent(event) {
        if (event.key === 'ring0_properties' || event.key === 'ring0_last_update') {
            // Reload properties from localStorage
            loadProperties();
            if (document.getElementById('adminPanel').classList.contains('active')) {
                loadAdminProperties();
            }
            showMessage('Properties updated from admin panel', 'success');
        }
    }

    // Check for updates from admin panel
    function checkForAdminUpdates() {
        const lastUpdate = localStorage.getItem('ring0_last_update') || '0';
        const lastSync = localStorage.getItem('ring0_user_last_sync') || '0';
        
        if (parseInt(lastUpdate) > parseInt(lastSync)) {
            // Properties have been updated by admin
            loadProperties();
            localStorage.setItem('ring0_user_last_sync', Date.now().toString());
            showMessage('Properties updated automatically', 'success');
        }
    }

    // ==================== PROPERTY MANAGEMENT FUNCTIONS ====================
    
    // Load properties from localStorage
    function loadProperties() {
        try {
            const savedProperties = localStorage.getItem('ring0_properties');
            if (savedProperties) {
                properties = JSON.parse(savedProperties);
            } else {
                // Use sample data if none exist
                properties = sampleProperties;
                localStorage.setItem('ring0_properties', JSON.stringify(properties));
            }
            
            // Update counts
            updatePropertiesCount();
            
            // Load gallery
            loadGallery();
            
        } catch (e) {
            console.error('Error loading properties:', e);
            showMessage('Error loading properties data', 'error');
            properties = sampleProperties;
            loadGallery();
        }
    }

    // Save properties to localStorage with real-time sync
    function saveProperties() {
        try {
            localStorage.setItem('ring0_properties', JSON.stringify(properties));
            updatePropertiesCount();
            updateStats();
            checkForPropertiesNotification();
            
            // Trigger sync with admin panel
            localStorage.setItem('ring0_last_update', Date.now().toString());
            
            // Dispatch custom event for same-tab updates
            window.dispatchEvent(new CustomEvent('propertiesUpdated'));
            
            // Sync with Supabase immediately
            syncPropertiesToSupabase();
            
        } catch (e) {
            console.error('Error saving properties:', e);
            showMessage('Error saving properties', 'error');
        }
    }

    // Sync properties to Supabase with real-time updates
    async function syncPropertiesToSupabase() {
        if (!window.supabaseClient) {
            console.warn('Supabase client not available, skipping sync');
            return;
        }

        try {
            // Get current properties from localStorage
            const currentProperties = JSON.parse(localStorage.getItem('ring0_properties') || '[]');
            
            // Get existing properties from Supabase to compare
            const { data: existingData, error: fetchError } = await window.supabaseClient
                .from('properties')
                .select('id, updated_at');

            if (fetchError) {
                console.error('Error fetching existing properties from Supabase:', fetchError);
                showMessage('Failed to sync with Supabase', 'warning');
                return;
            }

            // Create a map of existing properties for quick lookup
            const existingMap = new Map();
            existingData.forEach(prop => {
                existingMap.set(prop.id, prop.updated_at);
            });

            // Prepare arrays for upsert operations
            const propertiesToUpsert = [];
            const propertiesToDelete = [];

            // Check each local property
            for (const property of currentProperties) {
                const existingUpdated = existingMap.get(property.id);
                
                // If property doesn't exist in Supabase or is newer locally, upsert it
                if (!existingUpdated) {
                    propertiesToUpsert.push(property);
                }
            }

            // Check for properties that exist in Supabase but not locally (deleted)
            const localIds = new Set(currentProperties.map(p => p.id));
            for (const existingProp of existingData) {
                if (!localIds.has(existingProp.id)) {
                    propertiesToDelete.push(existingProp.id);
                }
            }

            // Perform upsert operations
            if (propertiesToUpsert.length > 0) {
                const { error: upsertError } = await window.supabaseClient
                    .from('properties')
                    .upsert(propertiesToUpsert, { onConflict: 'id' });

                if (upsertError) {
                    console.error('Error upserting properties to Supabase:', upsertError);
                    showMessage('Failed to sync some properties to Supabase', 'warning');
                } else {
                    console.log(` Successfully synced ${propertiesToUpsert.length} properties to Supabase`);
                }
            }

            // Perform delete operations
            if (propertiesToDelete.length > 0) {
                const { error: deleteError } = await window.supabaseClient
                    .from('properties')
                    .delete()
                    .in('id', propertiesToDelete);

                if (deleteError) {
                    console.error('Error deleting properties from Supabase:', deleteError);
                    showMessage('Failed to sync property deletions to Supabase', 'warning');
                } else {
                    console.log(` Successfully deleted ${propertiesToDelete.length} properties from Supabase`);
                }
            }

            // If no changes needed, still log success
            if (propertiesToUpsert.length === 0 && propertiesToDelete.length === 0) {
                console.log(' Properties already in sync with Supabase');
            }

        } catch (error) {
            console.error('Error syncing properties to Supabase:', error);
            showMessage('Failed to sync with Supabase', 'warning');
        }
    }

    // Update properties count in notification badge
    function updatePropertiesCount() {
        const badge = document.getElementById('propertiesCount');
        if (badge) {
            const unclaimedCount = properties.filter(p => p.status === 'unclaimed').length;
            badge.textContent = unclaimedCount;
            badge.style.display = unclaimedCount > 0 ? 'flex' : 'none';
        }
    }

    // Update statistics
    function updateStats() {
        const totalProperties = properties.length;
        const idsFound = properties.filter(p => p.category === 'id').length;
        const othersFound = properties.filter(p => p.category === 'other').length;
        const claimedItems = properties.filter(p => p.status === 'claimed').length;
        
        document.getElementById('totalProperties').textContent = totalProperties;
        document.getElementById('idsFound').textContent = idsFound;
        document.getElementById('othersFound').textContent = othersFound;
        document.getElementById('claimedItems').textContent = claimedItems;
    }

    // Check if there are properties and show notification
    function checkForPropertiesNotification() {
        const notificationAlert = document.getElementById('notificationAlert');
        const unclaimedCount = properties.filter(p => p.status === 'unclaimed').length;
        
        if (unclaimedCount > 0) {
            notificationAlert.style.display = 'flex';
        } else {
            notificationAlert.style.display = 'none';
        }
    }

    // Switch between tabs
    function switchTab(tabId) {
        // Hide all tab contents
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Remove active class from all tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show selected tab
        const selectedTab = document.getElementById(tabId + 'Tab');
        if (selectedTab) {
            selectedTab.classList.add('active');
            
            // Activate corresponding tab button
            const tabBtn = document.querySelector(`.tab-btn[onclick="switchTab('${tabId}')"]`);
            if (tabBtn) {
                tabBtn.classList.add('active');
            }
            
            // Refresh data for the tab
            if (tabId === 'gallery') {
                loadGallery();
            } else if (tabId === 'search') {
                resetSearch();
            }
        }
    }

    // Category selection for upload
    function selectCategory(category) {
        selectedCategory = category;
        
        // Update UI
        document.querySelectorAll('.category-btn[data-category]').forEach(btn => {
            if (btn.getAttribute('data-category') === category) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        // Show/hide forms
        if (category === 'id') {
            document.getElementById('idForm').style.display = 'block';
            document.getElementById('otherForm').style.display = 'none';
        } else {
            document.getElementById('idForm').style.display = 'none';
            document.getElementById('otherForm').style.display = 'block';
        }
    }

    // Category selection for search
    function selectSearchCategory(category) {
        selectedSearchCategory = category;
        
        // Update UI
        document.querySelectorAll('.category-btn[data-search-category]').forEach(btn => {
            if (btn.getAttribute('data-search-category') === category) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        // Show/hide forms
        if (category === 'id') {
            document.getElementById('idSearchForm').style.display = 'block';
            document.getElementById('otherSearchForm').style.display = 'none';
        } else {
            document.getElementById('idSearchForm').style.display = 'none';
            document.getElementById('otherSearchForm').style.display = 'block';
        }
    }

    // Setup drag and drop for image upload
    function setupDragAndDrop() {
        const uploadArea = document.getElementById('imageUploadArea');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', function() {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length) {
                handleImageUpload({ target: { files: e.dataTransfer.files } });
            }
        });
    }

    // Trigger image upload
    function triggerImageUpload() {
        document.getElementById('imageInput').click();
    }

// Handle image upload with automatic Cloudinary upload with timeout and progress
function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    // ===== ENHANCED VALIDATION =====
    if (!CLOUDINARY_CONFIG.ALLOWED_TYPES.includes(file.type)) {
        showMessage('Only JPG, PNG, GIF, and WebP images are allowed', 'error');
        return;
    }

    if (file.size > CLOUDINARY_CONFIG.MAX_FILE_SIZE) {
        showMessage(`File size must be less than ${CLOUDINARY_CONFIG.MAX_FILE_SIZE / (1024 * 1024)}MB`, 'error');
        return;
    }
    // ===== END VALIDATION =====

    // Show uploading state
    const uploadArea = document.getElementById('imageUploadArea');
    const uploadText = document.querySelector('.image-upload-area .upload-text');
    const uploadIcon = document.querySelector('.image-upload-area .upload-icon');

    uploadText.textContent = 'Uploading to Cloudinary...';
    uploadText.style.color = 'var(--accent)';
    uploadIcon.className = 'fas fa-spinner fa-spin upload-icon';

    // Create progress indicator
    const progressContainer = document.createElement('div');
    progressContainer.id = 'uploadProgress';
    progressContainer.style.cssText = `
        margin-top: 15px;
        padding: 12px;
        background: rgba(12, 16, 36, 0.5);
        border-radius: 8px;
        border: 1px solid rgba(91, 140, 255, 0.3);
    `;

    progressContainer.innerHTML = `
        <div class="upload-progress-header">
          <span class="upload-progress-title">Upload Progress</span>
          <span class="upload-progress-percent" id="uploadPercent">0%</span>
        </div>
        <div class="upload-progress-bar">
          <div class="upload-progress-fill" id="uploadProgressBar"></div>
        </div>
        <div class="upload-progress-details">
          <span>File: ${file.name}</span>
          <span>${formatFileSize(file.size)}</span>
        </div>
    `;

    // Insert progress indicator
    uploadArea.appendChild(progressContainer);

    // Create AbortController for timeout
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), CLOUDINARY_CONFIG.UPLOAD_TIMEOUT);

    // Create FormData
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", CLOUDINARY_CONFIG.UPLOAD_PRESET);

    // Use XMLHttpRequest for better progress tracking
    const xhr = new XMLHttpRequest();
    xhr.open('POST', `https://api.cloudinary.com/v1_1/${CLOUDINARY_CONFIG.CLOUD_NAME}/image/upload`);

    // Progress tracking
    xhr.upload.addEventListener('progress', function(e) {
        if (e.lengthComputable) {
            const percent = Math.round((e.loaded / e.total) * 100);
            document.getElementById('uploadPercent').textContent = percent + '%';
            document.getElementById('uploadProgressBar').style.width = percent + '%';
        }
    });

    // Handle response
    xhr.onload = function() {
        clearTimeout(timeoutId);

        if (xhr.status >= 200 && xhr.status < 300) {
            try {
                const data = JSON.parse(xhr.responseText);

                // ===== ENHANCED RESPONSE VALIDATION =====
                if (!data.secure_url) {
                    console.error('Cloudinary response missing secure_url:', data);
                    throw new Error('Upload failed: No secure_url in response');
                }

                // Store the Cloudinary URL
                cloudinaryImageUrl = data.secure_url;

                // Preview image
                const preview = document.getElementById('imagePreview');
                preview.src = cloudinaryImageUrl;
                preview.style.display = 'block';

                // Update upload area text
                uploadText.textContent = 'Image uploaded to Cloudinary!';
                uploadText.style.color = 'var(--success)';
                uploadIcon.className = 'fas fa-check-circle upload-icon';

                // Clean up progress UI
                setTimeout(() => {
                    const progressContainer = document.getElementById('uploadProgress');
                    if (progressContainer) progressContainer.remove();
                }, 1000);

                console.log(" Cloudinary upload successful. URL:", cloudinaryImageUrl);
                showMessage('Image uploaded to Cloudinary successfully! Everyone can now see it.', 'success');
            } catch (error) {
                console.error(' Upload processing error:', error);

                // Clean up progress UI
                const progressContainer = document.getElementById('uploadProgress');
                if (progressContainer) progressContainer.remove();

                // Fallback to local preview
                fallbackToLocalPreview(file);
            }
        } else {
            console.error(' Upload failed with status:', xhr.status, xhr.statusText);

            // Clean up progress UI
            const progressContainer = document.getElementById('uploadProgress');
            if (progressContainer) progressContainer.remove();

            // Fallback to local preview
            fallbackToLocalPreview(file);
        }
    };

    // Handle errors
    xhr.onerror = function() {
        clearTimeout(timeoutId);
        console.error(' Network error during upload');

        // Clean up progress UI
        const progressContainer = document.getElementById('uploadProgress');
        if (progressContainer) progressContainer.remove();

        // Fallback to local preview
        fallbackToLocalPreview(file);
    };

    // Handle abort (timeout)
    xhr.ontimeout = function() {
        console.error(' Upload timed out');
        showMessage(`Upload timed out after ${CLOUDINARY_CONFIG.UPLOAD_TIMEOUT/1000} seconds. Please try again.`, 'warning');

        // Clean up progress UI
        const progressContainer = document.getElementById('uploadProgress');
        if (progressContainer) progressContainer.remove();

        uploadText.textContent = 'Upload failed. Click to try again.';
        uploadText.style.color = 'var(--warning)';
        uploadIcon.className = 'fas fa-exclamation-triangle upload-icon';

        // Reset file input
        document.getElementById('imageInput').value = '';
    };

    // Send request
    xhr.send(formData);
}

// ===== FALLBACK FUNCTION FOR LOCAL PREVIEW =====
function fallbackToLocalPreview(file) {
    const reader = new FileReader();
    const uploadText = document.querySelector('.image-upload-area .upload-text');
    const uploadIcon = document.querySelector('.image-upload-area .upload-icon');

    reader.onload = function(e) {
        const preview = document.getElementById('imagePreview');
        preview.src = e.target.result;
        preview.style.display = 'block';

        uploadText.textContent = 'Image ready (local preview only)';
        uploadText.style.color = 'var(--warning)';
        uploadIcon.className = 'fas fa-exclamation-triangle upload-icon';

        showMessage('Using local preview. Image not uploaded to Cloudinary.', 'warning');
    };

    reader.onerror = function() {
        showMessage('Failed to read image file', 'error');
        uploadText.textContent = 'Click to upload or drag & drop property image';
        uploadText.style.color = 'var(--muted)';
        uploadIcon.className = 'fas fa-cloud-upload-alt upload-icon';
    };

    reader.readAsDataURL(file);
    cloudinaryImageUrl = ''; // Reset Cloudinary URL
}

    // Reset form
    function resetForm() {
        // Reset image preview
        const preview = document.getElementById('imagePreview');
        preview.src = '';
        preview.style.display = 'none';

        // Reset upload area text
        const uploadText = document.querySelector('.image-upload-area .upload-text');
        uploadText.textContent = 'Click to upload or drag & drop property image';
        uploadText.style.color = 'var(--muted)';

        // Reset upload icon
        const uploadIcon = document.querySelector('.image-upload-area .upload-icon');
        uploadIcon.className = 'fas fa-cloud-upload-alt upload-icon';

        // Remove any progress containers
        const progressContainer = document.getElementById('uploadProgress');
        if (progressContainer) progressContainer.remove();

        // Reset Cloudinary URL
        cloudinaryImageUrl = '';

        // Reset form fields
        document.getElementById('ownerName').value = '';
        document.getElementById('regNumber').value = '';
        document.getElementById('idLocation').value = '';
        document.getElementById('propertyType').value = '';
        document.getElementById('propertyDescription').value = '';
        document.getElementById('otherLocation').value = '';
        document.getElementById('finderContact').value = '';

        // Reset file input
        document.getElementById('imageInput').value = '';

        // Reset to ID category
        selectCategory('id');

        showMessage('Form has been reset', 'success');
    }

    // Submit property to admin
    async function submitProperty() {
        // Get image
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');

        if (!imageInput.files[0] && !imagePreview.src) {
            showMessage('Please upload an image of the property', 'error');
            return;
        }

        // Check if Cloudinary upload is still in progress
        const progressContainer = document.getElementById('uploadProgress');
        if (progressContainer) {
            showMessage('Please wait for image upload to complete', 'warning');
            return;
        }

        // Validate based on category
        let newProperty = null;
        if (selectedCategory === 'id') {
            const ownerName = document.getElementById('ownerName').value.trim();
            const regNumber = document.getElementById('regNumber').value.trim();
            const location = document.getElementById('idLocation').value.trim();

            if (!ownerName) {
                showMessage('Please enter the owner\'s name', 'error');
                return;
            }

            if (!regNumber) {
                showMessage('Please enter the registration number', 'error');
                return;
            }

            if (!location) {
                showMessage('Please enter where you found the property', 'error');
                return;
            }

            // Create property object
            newProperty = {
                id: properties.length > 0 ? Math.max(...properties.map(p => p.id)) + 1 : 1,
                category: 'id',
                image: cloudinaryImageUrl || imagePreview.src || 'https://images.unsplash.com/photo-1589829545856-d10d557cf95f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                name: ownerName,
                regNumber: regNumber,
                description: `ID card found at ${location}`,
                location: location,
                date: new Date().toISOString().split('T')[0],
                status: 'unclaimed',
                type: 'ID Card',
                finderContact: document.getElementById('finderContact').value.trim(),
                addedDate: new Date().toISOString(),
                // Add Cloudinary status for tracking
                cloudinaryStatus: cloudinaryImageUrl ? 'uploaded' : 'local'
            };

            properties.push(newProperty);

        } else {
            const propertyType = document.getElementById('propertyType').value;
            const description = document.getElementById('propertyDescription').value.trim();
            const location = document.getElementById('otherLocation').value.trim();

            if (!propertyType) {
                showMessage('Please select the property type', 'error');
                return;
            }

            if (!description) {
                showMessage('Please describe the property', 'error');
                return;
            }

            if (!location) {
                showMessage('Please enter where you found the property', 'error');
                return;
            }

            // Create property object
            const typeLabels = {
                'bag': 'Bag/Backpack',
                'book': 'Book/Notebook',
                'cable': 'Cable/Charger',
                'wallet': 'Wallet/Purse',
                'keys': 'Keys',
                'electronic': 'Electronic Device',
                'clothing': 'Clothing Item',
                'other': 'Other Property'
            };

            newProperty = {
                id: properties.length > 0 ? Math.max(...properties.map(p => p.id)) + 1 : 1,
                category: 'other',
                image: cloudinaryImageUrl || imagePreview.src || 'https://images.unsplash.com/photo-1545235617-9465d2a55698?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2080&q=80',
                name: '',
                regNumber: '',
                description: description,
                location: location,
                date: new Date().toISOString().split('T')[0],
                status: 'unclaimed',
                type: typeLabels[propertyType] || 'Other Property',
                finderContact: document.getElementById('finderContact').value.trim(),
                addedDate: new Date().toISOString(),
                // Add Cloudinary status for tracking
                cloudinaryStatus: cloudinaryImageUrl ? 'uploaded' : 'local'
            };

            properties.push(newProperty);
        }

        // Save properties locally
        saveProperties();

        // Try to persist to Supabase if configured
        if (window.supabaseClient) {
            try {
                const insertPayload = Object.assign({}, newProperty);
                // Optionally let DB set timestamps; remove client-only fields
                delete insertPayload.addedDate;

                const { data, error } = await window.supabaseClient.from('properties').insert([insertPayload]);
                if (error) throw error;
                console.log('Supabase: property saved', data);
                showMessage('Property saved to Supabase as well.', 'success');
            } catch (err) {
                console.error('Supabase insert error:', err);
                showMessage('Saved locally but failed to save to Supabase.', 'warning');
            }
        }

        // Reset form
        resetForm();

        // Auto-refresh gallery if someone is viewing it
        if (document.getElementById('galleryTab').classList.contains('active')) {
            loadGallery();
        }

        // Notify all users about new property (for real-time feeling)
        localStorage.setItem('ring0_new_property_added', Date.now().toString());

        // Show success message with Cloudinary status
        const successMessage = cloudinaryImageUrl
            ? 'Property submitted to admin successfully! Image uploaded to Cloudinary.'
            : 'Property submitted to admin successfully! Using local image preview.';
        showMessage(successMessage, 'success');

        // Switch to gallery to see the new property
        setTimeout(() => {
            switchTab('gallery');
        }, 1500);
    }

    // Reset search
    function resetSearch() {
        document.getElementById('searchName').value = '';
        document.getElementById('searchRegNumber').value = '';
        document.getElementById('searchDescription').value = '';
        document.getElementById('searchPropertyType').value = '';
        
        document.getElementById('searchResults').style.display = 'none';
        
        selectSearchCategory('id');
    }

    // Search property
    function searchProperty() {
        let searchResults = [];
        
        if (selectedSearchCategory === 'id') {
            const searchName = document.getElementById('searchName').value.trim().toLowerCase();
            const searchReg = document.getElementById('searchRegNumber').value.trim().toLowerCase();
            
            if (!searchName) {
                showMessage('Please enter your name to search', 'error');
                return;
            }
            
            // Search in ID properties
            searchResults = properties.filter(p => 
                p.category === 'id' && 
                p.status === 'unclaimed' &&
                (p.name.toLowerCase().includes(searchName) || 
                 (searchReg && p.regNumber.toLowerCase().includes(searchReg)))
            );
            
        } else {
            const searchDescription = document.getElementById('searchDescription').value.trim().toLowerCase();
            const searchType = document.getElementById('searchPropertyType').value;
            
            if (!searchDescription) {
                showMessage('Please describe your property to search', 'error');
                return;
            }
            
            // Search in other properties
            searchResults = properties.filter(p => 
                p.category === 'other' && 
                p.status === 'unclaimed' &&
                (p.description.toLowerCase().includes(searchDescription) ||
                 p.type.toLowerCase().includes(searchDescription))
            );
            
            // Filter by type if selected
            if (searchType) {
                searchResults = searchResults.filter(p => {
                    const typeMap = {
                        'bag': ['bag', 'backpack'],
                        'book': ['book', 'notebook'],
                        'cable': ['cable', 'charger'],
                        'wallet': ['wallet', 'purse'],
                        'keys': ['key', 'keys'],
                        'electronic': ['electronic', 'device', 'phone', 'laptop'],
                        'clothing': ['clothing', 'clothes', 'jacket', 'shirt'],
                        'other': ['other']
                    };
                    
                    const searchTerms = typeMap[searchType] || [searchType];
                    return searchTerms.some(term => 
                        p.type.toLowerCase().includes(term) || 
                        p.description.toLowerCase().includes(term)
                    );
                });
            }
        }
        
        // Display results
        displaySearchResults(searchResults);
    }

    // Display search results
    function displaySearchResults(results) {
        const resultsContainer = document.getElementById('searchResultsContainer');
        const resultsSection = document.getElementById('searchResults');
        
        if (results.length === 0) {
            resultsContainer.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-icon"></div>
                    <h3 class="empty-title">No Properties Found</h3>
                    <p class="empty-text">No properties match your search criteria. Try adjusting your search terms or check back later.</p>
                </div>
            `;
            resultsSection.style.display = 'block';
            return;
        }
        
        resultsContainer.innerHTML = '';
        
        results.forEach(property => {
            const propertyCard = createPropertyCard(property);
            resultsContainer.appendChild(propertyCard);
        });
        
        resultsSection.style.display = 'block';
    }

    // Load gallery
    function loadGallery() {
        const galleryContainer = document.getElementById('galleryContainer');
        
        if (properties.length === 0) {
            galleryContainer.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-icon"></div>
                    <h3 class="empty-title">No Properties Found</h3>
                    <p class="empty-text">No properties have been reported yet. Be the first to report a found item!</p>
                    <button class="form-btn primary" onclick="switchTab('upload')">
                        <i class="fas fa-upload"></i> Report Found Item
                    </button>
                </div>
            `;
            return;
        }
        
        // Filter properties based on current view
        let filtered = [...properties];
        
        if (currentView === 'id') {
            filtered = filtered.filter(p => p.category === 'id');
        } else if (currentView === 'other') {
            filtered = filtered.filter(p => p.category === 'other');
        } else if (currentView === 'unclaimed') {
            filtered = filtered.filter(p => p.status === 'unclaimed');
        }
        
        galleryContainer.innerHTML = '';
        
        if (filtered.length === 0) {
            galleryContainer.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-icon"></div>
                    <h3 class="empty-title">No Properties in This Category</h3>
                    <p class="empty-text">No properties match the current filter. Try selecting a different category.</p>
                </div>
            `;
            return;
        }
        
        filtered.forEach(property => {
            const propertyCard = createPropertyCard(property);
            galleryContainer.appendChild(propertyCard);
        });
    }

    // Create property card element
    function createPropertyCard(property) {
        const card = document.createElement('div');
        card.className = 'property-card';
        
        // Format date
        const date = new Date(property.date);
        const formattedDate = date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
        });
        
        // Determine status badge
        let statusBadge = '';
        if (property.status === 'claimed') {
            statusBadge = `<span class="status-badge status-claimed">Claimed</span>`;
        } else {
            statusBadge = `<span class="status-badge status-pending">Unclaimed</span>`;
        }
        
        // Determine type badge
        const typeBadge = `<span class="property-type">${property.type}</span>`;
        
        // Add real-time indicator for recently added items (last 5 minutes)
        const isRecent = (Date.now() - new Date(property.addedDate || property.date).getTime()) < 5 * 60 * 1000;
        const recentBadge = isRecent ? '<div style="position: absolute; top: 10px; right: 10px; background: var(--accent); color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold;">NEW</div>' : '';
        
        card.innerHTML = `
            <div style="position: relative;">
                <img src="${property.image}" alt="${property.type}" class="property-image">
                ${recentBadge}
            </div>
            <div class="property-content">
                <div class="property-header">
                    ${typeBadge}
                    <div class="property-date">${formattedDate}</div>
                </div>
                ${property.category === 'id' ? `
                    <div class="property-title">${property.name}</div>
                    <div class="property-details">Registration: ${property.regNumber}</div>
                ` : `
                    <div class="property-title">${property.type}</div>
                    <div class="property-details">${property.description.substring(0, 80)}${property.description.length > 80 ? '...' : ''}</div>
                `}
                <div class="property-info">
                    <div class="info-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Found at: ${property.location}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-info-circle"></i>
                        <span>Status: ${statusBadge}</span>
                    </div>
                </div>
                <div class="property-actions">
                    <button class="action-btn details" onclick="viewPropertyDetails(${property.id})">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                    ${property.status === 'unclaimed' ? `
                        <button class="action-btn claim" onclick="openClaimModal(${property.id})">
                            <i class="fas fa-hand-paper"></i> Claim
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
        
        return card;
    }

    // Filter properties in gallery
    function filterProperties(view) {
        currentView = view;
        
        // Update active button
        document.querySelectorAll('.view-btn').forEach(btn => {
            if (btn.getAttribute('data-view') === view) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        // Reload gallery
        loadGallery();
    }

    // View property details
    function viewPropertyDetails(propertyId) {
        const property = properties.find(p => p.id === propertyId);
        if (!property) return;
        
        currentPropertyId = propertyId;
        
        // Format date
        const date = new Date(property.date);
        const formattedDate = date.toLocaleDateString('en-US', { 
            weekday: 'long',
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        // Update modal content
        document.getElementById('modalImage').src = property.image;
        document.getElementById('modalType').textContent = property.type;
        document.getElementById('modalDate').textContent = formattedDate;
        document.getElementById('modalLocation').textContent = property.location;
        
        if (property.category === 'id') {
            document.getElementById('modalNameItem').style.display = 'flex';
            document.getElementById('modalRegItem').style.display = 'flex';
            document.getElementById('modalDescItem').style.display = 'none';
            document.getElementById('modalName').textContent = property.name;
            document.getElementById('modalReg').textContent = property.regNumber;
        } else {
            document.getElementById('modalNameItem').style.display = 'none';
            document.getElementById('modalRegItem').style.display = 'none';
            document.getElementById('modalDescItem').style.display = 'flex';
            document.getElementById('modalDesc').textContent = property.description;
        }
        
        // Update status
        const statusElement = document.getElementById('modalStatus');
        statusElement.textContent = property.status === 'claimed' ? 'Claimed' : 'Unclaimed';
        statusElement.className = property.status === 'claimed' ? 'status-badge status-claimed' : 'status-badge status-pending';
        
        // Show/hide claim button
        const claimButton = document.getElementById('claimButton');
        if (property.status === 'claimed') {
            claimButton.style.display = 'none';
        } else {
            claimButton.style.display = 'inline-flex';
        }
        
        // Show modal
        document.getElementById('propertyModal').classList.add('active');
    }

    // Close property details modal
    function closePropertyModal() {
        document.getElementById('propertyModal').classList.remove('active');
        currentPropertyId = null;
    }

    // Open claim modal
    function openClaimModal(propertyId) {
        currentPropertyId = propertyId;
        document.getElementById('claimModal').classList.add('active');
        
        // Reset form
        document.getElementById('claimantName').value = '';
        document.getElementById('claimantContact').value = '';
        document.getElementById('claimProof').value = '';
    }

    // Close claim modal
    function closeClaimModal() {
        document.getElementById('claimModal').classList.remove('active');
        currentPropertyId = null;
    }

    // Submit claim request
    function submitClaim() {
        const claimantName = document.getElementById('claimantName').value.trim();
        const claimantContact = document.getElementById('claimantContact').value.trim();
        
        if (!claimantName) {
            showMessage('Please enter your name', 'error');
            return;
        }
        
        if (!claimantContact) {
            showMessage('Please enter your contact information', 'error');
            return;
        }
        
        // Update property status
        const propertyIndex = properties.findIndex(p => p.id === currentPropertyId);
        if (propertyIndex !== -1) {
            properties[propertyIndex].status = 'claimed';
            properties[propertyIndex].claimantName = claimantName;
            properties[propertyIndex].claimantContact = claimantContact;
            properties[propertyIndex].claimProof = document.getElementById('claimProof').value.trim();
            properties[propertyIndex].claimDate = new Date().toISOString().split('T')[0];
            
            saveProperties();
        }
        
        // Close modals
        closeClaimModal();
        closePropertyModal();
        
        // Show success message
        showMessage('Claim request submitted successfully! Admin will contact you shortly.', 'success');
        
        // Reload gallery
        setTimeout(() => {
            loadGallery();
        }, 500);
    }

    // Claim property directly from details modal
    function claimProperty() {
        openClaimModal(currentPropertyId);
    }

    // ==================== ADMIN FUNCTIONS ====================
    
    // Open admin login modal
    function openAdminLogin() {
        document.getElementById('adminLoginModal').classList.add('active');
        document.getElementById('adminPassword').value = '';
        document.getElementById('adminPasswordError').style.display = 'none';
    }
    
    // Close admin login modal
    function closeAdminLogin() {
        document.getElementById('adminLoginModal').classList.remove('active');
    }
    
    
// Admin login function
function adminLogin() {
    const passwordInput = document.getElementById('adminPassword');
    const passwordError = document.getElementById('adminPasswordError');

    if (passwordInput.value === ADMIN_PASSWORD) {
        // Store login state for properties system
        localStorage.setItem('ring0_admin_logged_in', 'true');

        // Also sync with main system if coming from there
        const urlParams = new URLSearchParams(window.location.search);
        const sourceParam = urlParams.get('source');

        if (sourceParam === 'index') {
            // Create a session for main system too
            const adminSession = {
                loggedIn: true,
                timestamp: Date.now(),
                fromProperties: true
            };
            localStorage.setItem('ring0_admin_login', JSON.stringify(adminSession));
        }

        closeAdminLogin();

        // Check if this is direct access
        const cameFromDirectAccess = localStorage.getItem('ring0_direct_access') === 'true';

        if (cameFromDirectAccess) {
            // Show admin panel directly for direct access
            showAdminPanel();
            loadAdminProperties();
            updateBackButtonText();
            showMessage('Welcome to Admin Panel!', 'success');
        } else {
            // Regular admin login from properties page
            showAdminPanel();
            loadAdminProperties();
            updateBackButtonText();
            showMessage('Admin login successful!', 'success');
        }
    } else {
        // Incorrect password - direct to user interface
        closeAdminLogin();

        // Clear any admin flags for properties
        localStorage.removeItem('ring0_admin_logged_in');
        localStorage.removeItem('ring0_direct_access');
        localStorage.removeItem('ring0_admin_source');

        // Show user interface
        document.querySelector('.main-container').style.display = 'block';
        document.querySelector('.hero-section').style.display = 'flex';
        document.querySelector('.header').style.display = 'flex';
        document.getElementById('adminPanel').classList.remove('active');

        // Load user gallery
        loadGallery();

        showMessage('Incorrect password. Showing user interface.', 'warning');
    }
}
    
    // Show admin panel
    function showAdminPanel() {
        document.querySelector('.main-container').style.display = 'none';
        document.querySelector('.hero-section').style.display = 'none';
        document.querySelector('.header').style.display = 'none';
        document.getElementById('adminPanel').classList.add('active');
    }
    
    // Go back to user interface
    // Go back to user interface
function goToUserInterface() {
    document.getElementById('adminPanel').classList.remove('active');
    document.querySelector('.main-container').style.display = 'block';
    document.querySelector('.hero-section').style.display = 'flex';
    document.querySelector('.header').style.display = 'flex';
    
    // Update back button text
    updateBackButtonText();
    
    // Reload gallery
    loadGallery();
}
    
   // Logout admin
function logoutAdmin() {
    const cameFromDirectAccess = localStorage.getItem('ring0_direct_access') === 'true';
    const adminSource = localStorage.getItem('ring0_admin_source');
    
    // Clear admin login states
    localStorage.removeItem('ring0_admin_logged_in');
    localStorage.removeItem('ring0_direct_access');
    localStorage.removeItem('ring0_admin_source');
    
    // Also clear main system session if we created one
    const adminSession = localStorage.getItem('ring0_admin_login');
    if (adminSession) {
        try {
            const session = JSON.parse(adminSession);
            if (session.fromProperties) {
                localStorage.removeItem('ring0_admin_login');
            }
        } catch(e) {
            // Ignore errors
        }
    }
    
    // Update back button text
    updateBackButtonText();
    
    if (cameFromDirectAccess && adminSource === 'index') {
        // If came from index.html direct access, go back there
        window.location.href = 'index.html';
    } else {
        // Show user interface
        goToUserInterface();
        showMessage('Admin logged out successfully', 'success');
    }
}
    
    // Load properties for admin panel
    function loadAdminProperties() {
        try {
            const savedProperties = localStorage.getItem('ring0_properties');
            if (savedProperties) {
                adminProperties = JSON.parse(savedProperties);
            } else {
                adminProperties = sampleProperties;
            }
            
            updateAdminStats();
            renderAllAdminTables();
            
        } catch (e) {
            console.error('Error loading admin properties:', e);
            showMessage('Error loading properties data', 'error');
            adminProperties = sampleProperties;
            renderAllAdminTables();
        }
    }
    
    // Update admin statistics
    function updateAdminStats() {
        const totalItems = adminProperties.length;
        const idCards = adminProperties.filter(p => p.category === 'id').length;
        const otherItems = adminProperties.filter(p => p.category === 'other').length;
        const claimedItems = adminProperties.filter(p => p.status === 'claimed').length;
        
        document.getElementById('adminTotalItems').textContent = totalItems;
        document.getElementById('adminIdCards').textContent = idCards;
        document.getElementById('adminOtherItems').textContent = otherItems;
        document.getElementById('adminClaimedItems').textContent = claimedItems;
    }
    
    // Refresh admin data
    function refreshAdminData() {
        loadAdminProperties();
        showMessage('Admin data refreshed successfully', 'success');
    }
    
    // Switch admin tabs
    function switchAdminTab(tab) {
        currentAdminTab = tab;
        
        // Update active tab button
        document.querySelectorAll('.admin-tab-btn').forEach(btn => {
            if (btn.getAttribute('onclick') === `switchAdminTab('${tab}')`) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        // Show/hide tab content
        document.querySelectorAll('.admin-tab-content').forEach(content => {
            if (content.id === `admin${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`) {
                content.classList.add('active');
            } else {
                content.classList.remove('active');
            }
        });
        
        // Apply current filters to the new tab
        renderAdminTable(tab);
    }
    
    // Filter admin by category
    function filterAdminByCategory(category) {
        currentAdminCategoryFilter = category;
        
        // Update active filter button
        document.querySelectorAll('.filter-btn').forEach(btn => {
            if (btn.getAttribute('onclick') === `filterAdminByCategory('${category}')`) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        // Apply filter to current tab
        renderAdminTable(currentAdminTab);
    }
    
    // Search admin properties
    function searchAdminProperties() {
        renderAdminTable(currentAdminTab);
    }
    
    // Render all admin tables
    function renderAllAdminTables() {
        renderAdminTable('all');
        renderAdminTable('claimed');
        renderAdminTable('unclaimed');
        renderAdminTable('recent');
    }
    
    // Render admin table based on tab
    function renderAdminTable(tab) {
        let filteredProperties = [...adminProperties];
        const searchTerm = document.getElementById('adminSearchInput').value.toLowerCase();
        
        // Apply category filter
        if (currentAdminCategoryFilter !== 'all') {
            filteredProperties = filteredProperties.filter(p => p.category === currentAdminCategoryFilter);
        }
        
        // Apply search filter
        if (searchTerm) {
            filteredProperties = filteredProperties.filter(p => 
                (p.name && p.name.toLowerCase().includes(searchTerm)) ||
                (p.regNumber && p.regNumber.toLowerCase().includes(searchTerm)) ||
                (p.description && p.description.toLowerCase().includes(searchTerm)) ||
                (p.location && p.location.toLowerCase().includes(searchTerm)) ||
                (p.type && p.type.toLowerCase().includes(searchTerm))
            );
        }
        
        // Apply tab-specific filtering
        switch(tab) {
            case 'claimed':
                filteredProperties = filteredProperties.filter(p => p.status === 'claimed');
                renderAdminClaimedTable(filteredProperties);
                break;
            case 'unclaimed':
                filteredProperties = filteredProperties.filter(p => p.status === 'unclaimed');
                renderAdminUnclaimedTable(filteredProperties);
                break;
            case 'recent':
                // Show properties added in the last 7 days
                const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                filteredProperties = filteredProperties.filter(p => new Date(p.addedDate || p.date) > oneWeekAgo);
                // Sort by most recent first
                filteredProperties.sort((a, b) => new Date(b.addedDate || b.date) - new Date(a.addedDate || a.date));
                renderAdminRecentTable(filteredProperties);
                break;
            default: // 'all'
                renderAdminAllTable(filteredProperties);
                break;
        }
    }
    
    // Render "All Properties" table for admin
    function renderAdminAllTable(filteredProperties) {
        const tableBody = document.getElementById('adminAllPropertiesTable');
        const emptyState = document.getElementById('adminAllEmptyState');
        
        if (filteredProperties.length === 0) {
            tableBody.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        
        let tableHTML = '';
        filteredProperties.forEach(property => {
            const date = new Date(property.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            tableHTML += `
                <tr>
                    <td><img src="${property.image}" alt="${property.type}" class="property-image-small"></td>
                    <td>
                        <span class="category-badge">${property.category === 'id' ? 'ID Card' : 'Other'}</span><br>
                        <small>${property.type}</small>
                    </td>
                    <td>
                        ${property.category === 'id' ? 
                            `<strong>${property.name}</strong><br>
                             <small>Reg: ${property.regNumber}</small>` : 
                            `<strong>${property.type}</strong><br>
                             <small>${property.description.substring(0, 50)}${property.description.length > 50 ? '...' : ''}</small>`
                        }
                    </td>
                    <td>${property.location}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <span class="status-badge ${property.status === 'claimed' ? 'status-claimed' : 'status-unclaimed'}">
                            ${property.status === 'claimed' ? 'Claimed' : 'Unclaimed'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="admin-action-btn view" onclick="viewAdminPropertyDetails(${property.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="admin-action-btn delete" onclick="openDeleteModal(${property.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = tableHTML;
    }
    
    // Render "Claimed Properties" table for admin
    function renderAdminClaimedTable(filteredProperties) {
        const tableBody = document.getElementById('adminClaimedPropertiesTable');
        const emptyState = document.getElementById('adminClaimedEmptyState');
        
        if (filteredProperties.length === 0) {
            tableBody.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        
        let tableHTML = '';
        filteredProperties.forEach(property => {
            const claimDate = property.claimDate ? new Date(property.claimDate) : new Date(property.date);
            const formattedClaimDate = claimDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            tableHTML += `
                <tr>
                    <td><img src="${property.image}" alt="${property.type}" class="property-image-small"></td>
                    <td>
                        <span class="category-badge">${property.category === 'id' ? 'ID Card' : 'Other'}</span><br>
                        <small>${property.type}</small>
                    </td>
                    <td>
                        ${property.category === 'id' ? 
                            `<strong>${property.name}</strong><br>
                             <small>Reg: ${property.regNumber}</small>` : 
                            `<strong>${property.type}</strong><br>
                             <small>${property.description.substring(0, 50)}${property.description.length > 50 ? '...' : ''}</small>`
                        }
                    </td>
                    <td>
                        <strong>${property.claimantName || 'N/A'}</strong><br>
                        <small>${property.claimantContact || ''}</small>
                    </td>
                    <td>${formattedClaimDate}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="admin-action-btn view" onclick="viewAdminPropertyDetails(${property.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="admin-action-btn delete" onclick="openDeleteModal(${property.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = tableHTML;
    }
    
    // Render "Unclaimed Properties" table for admin
    function renderAdminUnclaimedTable(filteredProperties) {
        const tableBody = document.getElementById('adminUnclaimedPropertiesTable');
        const emptyState = document.getElementById('adminUnclaimedEmptyState');
        
        if (filteredProperties.length === 0) {
            tableBody.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        
        let tableHTML = '';
        filteredProperties.forEach(property => {
            const date = new Date(property.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            tableHTML += `
                <tr>
                    <td><img src="${property.image}" alt="${property.type}" class="property-image-small"></td>
                    <td>
                        <span class="category-badge">${property.category === 'id' ? 'ID Card' : 'Other'}</span><br>
                        <small>${property.type}</small>
                    </td>
                    <td>
                        ${property.category === 'id' ? 
                            `<strong>${property.name}</strong><br>
                             <small>Reg: ${property.regNumber}</small>` : 
                            `<strong>${property.type}</strong><br>
                             <small>${property.description.substring(0, 50)}${property.description.length > 50 ? '...' : ''}</small>`
                        }
                    </td>
                    <td>${property.location}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="admin-action-btn view" onclick="viewAdminPropertyDetails(${property.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="admin-action-btn delete" onclick="openDeleteModal(${property.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = tableHTML;
    }
    
    // Render "Recently Added" table for admin
    function renderAdminRecentTable(filteredProperties) {
        const tableBody = document.getElementById('adminRecentPropertiesTable');
        const emptyState = document.getElementById('adminRecentEmptyState');
        
        if (filteredProperties.length === 0) {
            tableBody.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        
        let tableHTML = '';
        filteredProperties.forEach(property => {
            const date = new Date(property.addedDate || property.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Calculate how many days ago
            const daysAgo = Math.floor((new Date() - date) / (1000 * 60 * 60 * 24));
            const timeAgo = daysAgo === 0 ? 'Today' : daysAgo === 1 ? 'Yesterday' : `${daysAgo} days ago`;
            
            tableHTML += `
                <tr>
                    <td><img src="${property.image}" alt="${property.type}" class="property-image-small"></td>
                    <td>
                        <span class="category-badge">${property.category === 'id' ? 'ID Card' : 'Other'}</span><br>
                        <small>${property.type}</small>
                    </td>
                    <td>
                        ${property.category === 'id' ? 
                            `<strong>${property.name}</strong><br>
                             <small>Reg: ${property.regNumber}</small>` : 
                            `<strong>${property.type}</strong><br>
                             <small>${property.description.substring(0, 50)}${property.description.length > 50 ? '...' : ''}</small>`
                        }
                        <br><small style="color: var(--muted); font-size: 0.8rem;">${timeAgo}</small>
                    </td>
                    <td>${property.location}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <span class="status-badge ${property.status === 'claimed' ? 'status-claimed' : 'status-unclaimed'}">
                            ${property.status === 'claimed' ? 'Claimed' : 'Unclaimed'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="admin-action-btn view" onclick="viewAdminPropertyDetails(${property.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="admin-action-btn delete" onclick="openDeleteModal(${property.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = tableHTML;
    }
    
    // View property details in admin panel
    function viewAdminPropertyDetails(propertyId) {
        const property = adminProperties.find(p => p.id === propertyId);
        if (!property) return;
        
        currentPropertyId = propertyId;
        
        const date = new Date(property.date);
        const formattedDate = date.toLocaleDateString('en-US', { 
            weekday: 'long',
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        const addedDate = property.addedDate ? new Date(property.addedDate) : date;
        const formattedAddedDate = addedDate.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        let detailsHTML = `
            <div style="margin-bottom: 20px;">
                <img src="${property.image}" alt="${property.type}" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 20px;">
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Type</div>
                        <div style="font-weight: 600;">${property.type}</div>
                    </div>
                    <div>
                        <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Category</div>
                        <div style="font-weight: 600;">${property.category === 'id' ? 'ID Card' : 'Other Item'}</div>
                    </div>
                    <div>
                        <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Found Date</div>
                        <div style="font-weight: 600;">${formattedDate}</div>
                    </div>
                    <div>
                        <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Added Date</div>
                        <div style="font-weight: 600;">${formattedAddedDate}</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Location Found</div>
                    <div style="font-weight: 600;">${property.location}</div>
                </div>
        `;
        
        if (property.category === 'id') {
            detailsHTML += `
                <div style="margin-bottom: 15px;">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Owner Name</div>
                    <div style="font-weight: 600;">${property.name}</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Registration Number</div>
                    <div style="font-weight: 600;">${property.regNumber}</div>
                </div>
            `;
        } else {
            detailsHTML += `
                <div style="margin-bottom: 15px;">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Description</div>
                    <div style="font-weight: 600;">${property.description}</div>
                </div>
            `;
        }
        
        detailsHTML += `
                <div style="margin-bottom: 15px;">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Status</div>
                    <span class="status-badge ${property.status === 'claimed' ? 'status-claimed' : 'status-unclaimed'}" style="font-size: 0.9rem;">
                        ${property.status === 'claimed' ? 'Claimed' : 'Unclaimed'}
                    </span>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 5px;">Finder Contact</div>
                    <div style="font-weight: 600;">${property.finderContact || 'Not provided'}</div>
                </div>
        `;
        
        if (property.status === 'claimed') {
            detailsHTML += `
                <div style="background: rgba(53, 208, 127, 0.1); border-radius: 8px; padding: 15px; margin-top: 20px; border: 1px solid rgba(53, 208, 127, 0.3);">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 10px;">Claim Information</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <div style="color: var(--muted); font-size: 0.8rem; margin-bottom: 5px;">Claimant Name</div>
                            <div style="font-weight: 600;">${property.claimantName || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="color: var(--muted); font-size: 0.8rem; margin-bottom: 5px;">Claim Date</div>
                            <div style="font-weight: 600;">${property.claimDate || 'N/A'}</div>
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <div style="color: var(--muted); font-size: 0.8rem; margin-bottom: 5px;">Claimant Contact</div>
                            <div style="font-weight: 600;">${property.claimantContact || 'N/A'}</div>
                        </div>
                        ${property.claimProof ? `
                            <div style="grid-column: 1 / -1;">
                                <div style="color: var(--muted); font-size: 0.8rem; margin-bottom: 5px;">Proof/Additional Info</div>
                                <div style="font-weight: 600;">${property.claimProof}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Add action buttons for admin
        detailsHTML += `
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="color: var(--muted); font-size: 0.9rem; margin-bottom: 15px;">Admin Actions</div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="admin-action-btn view" onclick="viewAdminPropertyDetails(${property.id})" style="background: rgba(91, 140, 255, 0.1); color: var(--accent); border: 1px solid rgba(91, 140, 255, 0.3);">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                        <button class="admin-action-btn delete" onclick="openDeleteModal(${property.id})" style="background: rgba(255, 107, 107, 0.1); color: var(--warning); border: 1px solid rgba(255, 107, 107, 0.3);">
                            <i class="fas fa-trash"></i> Delete Property
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('adminModalContent').innerHTML = detailsHTML;
        document.getElementById('adminDetailsModal').classList.add('active');
    }
    
    // Close admin details modal
    function closeAdminDetailsModal() {
        document.getElementById('adminDetailsModal').classList.remove('active');
    }
    
    // Open delete confirmation modal
    function openDeleteModal(propertyId) {
        currentPropertyId = propertyId;
        document.getElementById('deleteModal').classList.add('active');
    }
    
    // Close delete modal
    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
        currentPropertyId = null;
    }
    
    // Confirm delete property
    async function confirmDelete() {
        if (!currentPropertyId) return;

        try {
            // Show loading state
            const deleteButton = document.querySelector('#deleteModal .modal-btn.confirm');
            const originalText = deleteButton.innerHTML;
            deleteButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
            deleteButton.disabled = true;

            // Remove property from arrays
            properties = properties.filter(p => p.id !== currentPropertyId);
            adminProperties = adminProperties.filter(p => p.id !== currentPropertyId);
            
            // Save to localStorage
            localStorage.setItem('ring0_properties', JSON.stringify(properties));
            
            // Update sync timestamp for real-time updates
            localStorage.setItem('ring0_last_update', Date.now().toString());
            
            // Try to delete from Supabase if configured
            let supabaseSuccess = true;
            if (window.supabaseClient) {
                try {
                    const { error } = await window.supabaseClient
                        .from('properties')
                        .delete()
                        .eq('id', currentPropertyId);
                    
                    if (error) throw error;
                    console.log('Supabase: property deleted successfully');
                } catch (err) {
                    console.error('Supabase delete error:', err);
                    supabaseSuccess = false;
                    showMessage('Deleted locally but failed to sync with Supabase', 'warning');
                }
            }
            
            // Update stats and tables
            updateStats();
            updateAdminStats();
            loadGallery();
            renderAllAdminTables();
            
            // Show success message
            const message = supabaseSuccess 
                ? 'Property deleted successfully' 
                : 'Property deleted locally (offline)';
            showMessage(message, 'success');
            
        } catch (error) {
            console.error('Delete operation failed:', error);
            showMessage('Failed to delete property. Please try again.', 'error');
        } finally {
            // Reset button state
            const deleteButton = document.querySelector('#deleteModal .modal-btn.confirm');
            if (deleteButton) {
                deleteButton.innerHTML = '<i class="fas fa-trash"></i> Delete Property';
                deleteButton.disabled = false;
            }
            closeDeleteModal();
        }
    }

    // Show message
    function showMessage(message, type) {
        // Remove any existing messages
        const existingMessages = document.querySelectorAll('.custom-message');
        existingMessages.forEach(msg => msg.remove());

        const messageDiv = document.createElement('div');
        messageDiv.className = 'custom-message';
        messageDiv.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: ${type === 'error' ? 'rgba(255, 107, 107, 0.9)' : type === 'warning' ? 'rgba(255, 165, 0, 0.9)' : 'rgba(53, 208, 127, 0.9)'};
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            z-index: 9999;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        `;

        // Add appropriate icon based on message type
        const iconSpan = document.createElement('span');
        if (type === 'error') {
            iconSpan.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
        } else if (type === 'warning') {
            iconSpan.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
        } else {
            iconSpan.innerHTML = '<i class="fas fa-check-circle"></i>';
        }

        messageDiv.appendChild(iconSpan);
        messageDiv.appendChild(document.createTextNode(message));

        document.body.appendChild(messageDiv);

        setTimeout(() => {
            messageDiv.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                if (document.body.contains(messageDiv)) {
                    document.body.removeChild(messageDiv);
                }
            }, 300);
        }, 3000);

        // Add CSS animations if not already present
        if (!document.querySelector('#message-animations')) {
            const style = document.createElement('style');
            style.id = 'message-animations';
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                    20%, 40%, 60%, 80% { transform: translateX(5px); }
                }
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
    }


    // Close modals when clicking outside
    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                if (this.id === 'propertyModal') {
                    closePropertyModal();
                } else if (this.id === 'claimModal') {
                    closeClaimModal();
                } else if (this.id === 'adminLoginModal') {
                    closeAdminLogin();
                } else if (this.id === 'deleteModal') {
                    closeDeleteModal();
                } else if (this.id === 'adminDetailsModal') {
                    closeAdminDetailsModal();
                }
            }
        });
    });

    // Close modals with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closePropertyModal();
            closeClaimModal();
            closeAdminLogin();
            closeDeleteModal();
            closeAdminDetailsModal();
        }
    });
</script>
</body>
</html>
